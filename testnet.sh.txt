#!/bin/bash

clear

echo ======================Start of Script===============================
echo Script Name : testnet.sh
echo Purpose     : Summarize network settings and perform connectivity tests
echo Author      : Filip Wasowicz
echo Student No  : 041169446
echo Date        : $(date +%Y-%m-%d)
echo ====================================================================


echo -e "\n===== [1/3] SYSTEM & SERVICE STATUS ====="
# Check essential system services
echo -n "NetworkManager: "
systemctl is-active NetworkManager
echo -n "Firewalld:       "
systemctl is-active firewalld

iptables_status=$(systemctl is-active iptables 2>/dev/null)
if [[ -z "$iptables_status" ]]; then
    iptables_status="inactive"
fi
echo "Iptables: $iptables_status"


echo -n "SELinux status:  "
getenforce

echo -e "\n===== [2/3] NETWORK CONFIGURATION ====="
# Show interface info
echo -e "\n[IP Addresses]"
ip -brief addr show | grep -E 'ens|eth'

# DNS Servers
echo -e "\n[DNS Servers]"
grep nameserver /etc/resolv.conf

# Hostname resolution order
echo -e "\n[Hostname Resolution Order]"
grep hosts /etc/nsswitch.conf

# Hosts file content
echo -e "\n[/etc/hosts]"
grep -v '^#' /etc/hosts | grep -v '^$'

# Default gateway
echo -e "\n[Default Gateway]"
ip route | grep default

echo -e "\n===== [3/3] CONNECTIVITY TESTS ====="
# Ping Blue Network  SRV
echo -n "Ping Blue Network SRV (192.168.211.133): "
ping -c 1 192.168.211.133 &>/dev/null && echo "Success" || echo "Fail"

#Ping Blue Network CLT
echo -n "Ping Blue Network CLT (192.168.211.135): "
ping -c 1 192.168.211.135 &>/dev/null && echo "Sucess" || echo "Fail"

# Ping RED network SRV 
echo -n "Ping Server (172.16.30.102): "
ping -c 1 waso0006-srv.example102.lab &>/dev/null && echo "Success" || echo "Fail"

#Ping Red Netowkr CLT
echo -n "Ping Client (172.16.21.102): "
ping -c 1 waso0006-clt.example102.lab &>/dev/null && echo "Success" || echo "Fail"

# Ping gateway on BLUE network (via DHCP)
GATEWAY=$(ip route | grep default | awk '{print $3}')
echo -n "Ping Gateway (${GATEWAY}): "
ping -c 1 "$GATEWAY" &>/dev/null && echo "Success" || echo "Fail"

echo ===========================Script Complete====================================
